<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8"><title>{{ ticker_data.company_name }} ({{ ticker_data.ticker }})</title>
  <link rel="stylesheet" href="/static/css/retro.css">
</head><body><div class="container">
  <h1>{{ ticker_data.company_name }} — {{ ticker_data.ticker }}</h1>

  <div class="chart-block">
    {{ ticker_data.ticker_info | safe }}
  </div>

  <div class="chart-block">
    <h2>Revenue &amp; Net Income</h2>
    <img class="chart-img chart-block" src="{{ ticker_data.revenue_net_income_chart_path }}" alt="Revenue & Net Income">
    <div class="table-wrap">{{ ticker_data.financial_table | safe }}</div>
  </div>

  <div class="chart-block">
    <h2>EPS</h2>
    <img class="chart-img chart-block" src="{{ ticker_data.eps_chart_path }}" alt="EPS">
  </div>

  <div class="chart-block">
    <h2>Forecasts</h2>
    <img class="chart-img chart-block" src="{{ ticker_data.forecast_rev_net_chart_path }}" alt="Revenue/Net Income Forecast">
    <img class="chart-img chart-block" src="{{ ticker_data.forecast_eps_chart_path }}" alt="EPS Forecast">
  </div>

  <div class="chart-block">
    <h2>Y/Y % Change</h2>
    <img class="chart-img chart-block" src="{{ ticker_data.revenue_yoy_change_chart_path }}" alt="Revenue YoY Change">
    <img class="chart-img chart-block" src="{{ ticker_data.eps_yoy_change_chart_path }}" alt="EPS YoY Change">
    <div class="table-wrap">{{ ticker_data.yoy_growth_table_html | safe }}</div>
  </div>

  <div class="chart-block">
    <h2>Expenses</h2>
    <img class="chart-img chart-block" src="{{ ticker_data.expense_chart_path }}" alt="Revenue vs Expenses">
    <img class="chart-img chart-block" src="{{ ticker_data.expense_percent_chart_path }}" alt="Expenses % of Revenue">
    <div class="table-wrap">{{ ticker_data.expense_abs_html | safe }}</div>
    <div class="table-wrap">{{ ticker_data.expense_yoy_html | safe }}</div>
    <div class="table-wrap">{{ ticker_data.unmapped_expense_html | safe }}</div>
  </div>

  {% if ticker_data.segment_carousel_html or ticker_data.segment_table_html %}
  <div class="chart-block">
    <h2>Segment Performance</h2>
    {{ ticker_data.segment_carousel_html | safe }}

    <div class="segment-table-wrapper">
      <!-- Injected multi-section HTML from generator (may contain caption + multiple <h3> + tables) -->
      <div id="segment-sections">
        {{ ticker_data.segment_table_html | safe }}
      </div>

      <!-- Tabs + panes -->
      <div id="seg-tabs" class="seg-tabs" aria-label="Segment sections"></div>
      <div id="seg-panes"></div>

      <div class="seg-note">Tip: Click a tab to switch between Products / Services, Regions, Operating Segments, etc. If tabs don’t appear, the full combined table is shown.</div>
    </div>

    <!-- Lightweight, inline tab builder -->
    <script>
      (function(){
        const host = document.getElementById('segment-sections');
        if(!host) return;

        // Capture children before mutation
        const allKids = Array.from(host.childNodes);
        const h3s = allKids.filter(n => n.nodeType === 1 && n.tagName === 'H3');

        if(h3s.length === 0) return; // no <h3> → leave combined content as-is

        // Preserve any preface nodes BEFORE the first <h3> (e.g., caption/note)
        const firstH3Index = allKids.indexOf(h3s[0]);
        const prefaceNodes = firstH3Index > 0 ? allKids.slice(0, firstH3Index) : [];

        // Helper
        const slug = s => (s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'');

        // Build sections: for each <h3>, collect subsequent siblings until the next <h3> or end
        const sections = [];
        for (let i=0; i<h3s.length; i++) {
          const titleEl = h3s[i];
          const titleText = (titleEl.textContent || '').trim() || `Section ${i+1}`;
          const id = 'seg-' + (slug(titleText) || ('section-'+(i+1)));

          const nodes = [];
          let n = titleEl.nextSibling;
          while (n && !(n.nodeType === 1 && n.tagName === 'H3')) {
            nodes.push(n);
            n = n.nextSibling;
          }
          sections.push({ id, titleText, nodes });
        }

        // Clear original combined content
        host.innerHTML = '';

        // Re-append preface nodes at the top (so the caption/unit note remains visible)
        if(prefaceNodes.length) {
          const pre = document.createElement('div');
          pre.className = 'table-wrap';
          prefaceNodes.forEach(n => pre.appendChild(n));
          host.appendChild(pre);
        }

        const tabs = document.getElementById('seg-tabs');
        const panes = document.getElementById('seg-panes');

        // Construct tabs + panes
        sections.forEach((sec, idx) => {
          // tab
          const btn = document.createElement('button');
          btn.className = 'seg-tab' + (idx===0 ? ' active' : '');
          btn.type = 'button';
          btn.textContent = sec.titleText;
          btn.dataset.target = sec.id;
          tabs.appendChild(btn);

          // pane
          const pane = document.createElement('div');
          pane.className = 'seg-pane' + (idx===0 ? ' active' : '');
          pane.id = sec.id;

          // If generator already wrapped the table in .table-wrap, reuse it (avoid double nesting)
          const existingWrap = sec.nodes.find(n => n.nodeType === 1 && n.classList && n.classList.contains('table-wrap'));
          if (existingWrap) {
            pane.appendChild(existingWrap);
          } else {
            const wrap = document.createElement('div');
            wrap.className = 'table-wrap';
            sec.nodes.forEach(n => wrap.appendChild(n));
            pane.appendChild(wrap);
          }
          panes.appendChild(pane);
        });

        // Toggle behavior
        tabs.addEventListener('click', (e) => {
          const btn = e.target.closest('.seg-tab');
          if(!btn) return;
          const target = btn.dataset.target;
          tabs.querySelectorAll('.seg-tab').forEach(b => b.classList.toggle('active', b===btn));
          panes.querySelectorAll('.seg-pane').forEach(p => p.classList.toggle('active', p.id === target));
        });
      })();
    </script>
  </div>
  {% endif %}

  <div class="chart-block">
    <h2>Balance Sheet</h2>
    <img class="chart-img chart-block" src="{{ ticker_data.balance_sheet_chart_path }}" alt="Balance Sheet">
    <div class="table-wrap">{{ ticker_data.balance_sheet_table_html | safe }}</div>
  </div>

  <div class="chart-block">
    <h2>Valuation</h2>
    <img class="chart-img chart-block" src="{{ ticker_data.valuation_chart }}" alt="Valuation">
    <div class="table-wrap">{{ ticker_data.valuation_info_table | safe }}</div>
    <div class="table-wrap">{{ ticker_data.valuation_data_table | safe }}</div>
  </div>

  <div class="chart-block">
    <h2>Implied Growth</h2>
    <img class="chart-img chart-block" src="{{ ticker_data.implied_growth_chart_path }}" alt="Implied Growth">
    <div class="table-wrap">{{ ticker_data.implied_growth_table_html | safe }}</div>
  </div>

  <div class="chart-block">
    <h2>EPS &amp; Dividend</h2>
    <img class="chart-img chart-block" src="{{ ticker_data.eps_dividend_chart_path }}" alt="EPS & Dividend">
  </div>

  <p class="chart-block"><a href="../index.html">← Back</a></p>
</div></body></html>